mode OnOff = Off | accessible On

module Main {
  in  tmp : 'OnOff Float,      # temperature sensor
      hmd : 'OnOff Float       # humidity sensor
  out di : Float,       # discomfort index
      fan(False) : Bool # fan switch

  with tmp >= On, hmd >= Off

  # discomfort (temperature-humidity) index
  out node di =
    0.81 *. tmp +. 0.01 *. hmd *. (0.99 *. tmp -. 14.3) +. 46.3

  # hysteresis offset
  node ho = if fan@last then 0.5 else 0.5

  # fan switch
  out node fan = di >=. (- 75.0 +. ho)
}

